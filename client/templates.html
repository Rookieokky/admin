<template name="adminLayout">
  <div id="AdminLayout">
    <div id="AdminHeader">
      <div class="admin-wrapper">
        {{ > adminHeader }}
      </div>
    </div>
    <div id="AdminMain">
      <div class="admin-wrapper mt30">
        {{ > yield }}
      </div>
    </div>
  </div>
</template>

<template name="adminHeader">
  <div id="AdminSiteName">
    <a href="{{ pathFor route='AdminDashboard' }}" class="adminPath {{ isActivePath regex='admin$' }}">{{ adminOptions.title }}</a>
  </div>
  {{#if isInRole 'admin' }}
    <ul id="AdminNav" class="admin-cf">
      {{# each collections }}
        <li>
          <a href="{{ pathFor route='AdminCollection' }}" class="{{ isActivePath regex=name }}">{{ name }}</a>
        </li>
      {{/each}}
      <li class="right">
        <a href="#" class="active logout">
          {{ currentUser.emails.[0].address }}
          <i class="fa fa-sign-out"></i>
         </a>
      </li>
    </ul>
  {{/if}}
</template>

<template name="adminDashboard">
  <div id="AdminDashboard">
    <ul id="AdminCollections" class="admin-cf">
      {{#each collections }}
        <li>
          <div class="admin-collection-name">{{ admin.name }}</div>
          <div class="admin-collection-count">{{ count }}</div>
        </li>
      {{/each}}
    </ul>
  </div>
</template>

<template name="adminCollection">
  <div id="AdminListOptions" class="admin-cf">
    <div class="right">
      <a href="{{ pathFor route='AdminCollectionInsert' name=admin._name }}" class="admin-button">New {{ admin._name }}</a>
    </div>
  </div>
  <table class="admin-list-table">
    <thead>
      <tr>
        {{# each admin.fields }}
          <th><span>{{ name }}</span></th>
        {{/each}}
      </tr>
    </thead>
    <tbody>
      {{# each collection }}
        <tr>
          {{# each setIndex ../admin.fields }}
            <td>
              {{# if isBoolean }}
                <i class="fa fa-check-circle {{ getValue .. }}"></i>
              {{ else }}
                {{# if first }}
                  <a href="{{ pathFor route="AdminCollectionUpdate" name=../../admin._name _id=../_id }}">{{ getValue .. }}</a>
                {{ else }}
                  {{ getValue .. }}
                {{/if}}
              {{/if}}
            </td>
          {{/each}}
        </tr>
      {{ else }}
        <tr><td colspan="{{ admin.fields.length }}" class="yet">no {{ admin._name }}</td></tr>
      {{/each}}
    </tbody>
  </table>
  {{ > adminPagination }}
</template>

<template name="adminButtons">
  <button type="submit" class="admin-button mr5 left adminSaveButton">{{ saveButtonText }}</button>
  {{# if removeButtonText }}
    {{#quickRemoveButton collection=admin.name _id=doc._id onSuccess=onSuccess class="admin-button adminRemoveButton mr5 left" }}
      Remove
    {{/quickRemoveButton}}
  {{/if}}
</template>

<template name="adminCollectionInsert">
  <h3>New {{ admin._name }}</h3>
  {{# autoForm collection=admin.name id="insertForm" type="insert" }}
    {{# each afFieldNames }}
      {{> afQuickField name=this }}
    {{/each }}
    {{ > adminButtons saveButtonText="Insert" }}
  {{/autoForm}}
</template>

<template name="adminCollectionUpdate">
  <h3>Update {{ admin._name }}</h3>
  {{# autoForm collection=admin.name id="insertForm" type="update" doc=doc}}
    {{# each afFieldNames }}
      {{> afQuickField name=this }}
    {{/each }}
    {{ > adminButtons saveButtonText="Save" removeButtonText="Remove" doc=doc admin=admin }}
  {{/autoForm}}
</template>

<template name="adminPagination">
  {{# if collection }}
    <ul id="AdminPagination" class="admin-cf">
      {{# each pages }}
        <li>
          <a href="{{ pathFor route='AdminCollectionPagination' name=../admin._name }}" class="{{# if is page ../params.page }}current{{/if}}">
            {{ page }}
          </a>
        </li>
      {{/each}}
      <li class="count">
        {{ cursor.count }} {{ admin._name }}
      </li>
    </ul>
  {{/if}}
</template>

<template name="adminSignInForm">
  {{# unless isInRole 'admin' }}
    {{# autoForm schema=Schemas.adminSignInForm id="AdminSignInForm" type="normal" }}
      <span class="help-block">{{ session 'AdminSignInFormError' }}</span>
      {{> afQuickField name="email" }}
      {{> afQuickField name="password" }}
      <button class="admin-button">Login</button>
    {{/autoForm }}
  {{/unless}}
</template>

<template name="adminLoading">
  Admin loading..
</template>
